<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../paper-tabs/paper-tabs.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../uvalib-button/uvalib-button.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../uvalib-theme/uvalib-icons.html">
<link rel="import" href="uvalib-searchbox-behavior.html">

<!--
`uvalib-search-box`
Library Search Box

### Styling

The following custom properties are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--uvalib-search-box-font-family` | Font family used for search box content | `Based on uvalib-theme --font-primary`
`--uvalib-search-box-selected-tab-color` | Color of selected tab | `Based on uvalib-theme --color-primary-blue`
`--uvalib-search-box-selected-tab-text-color` | Color of selected tab text | `Based on uvalib-theme --color-white`
`--uvalib-search-box-tab-color` | Color of unselected tabs | `Based on uvalib-theme --color-light-blue`
`--uvalib-search-box-tab-text-color` | Color of unselected tab text | `Based on uvalib-theme --color-primary-blue`
`--uvalib-search-box-bkgrd-color` | Background color of search box | `Based on uvalib-theme --color-primary-blue`
`--uvalib-search-box-btn-bkgrd-color` | Background color of search button | `Based on uvalib-theme --color-light-blue`
`--uvalib-search-box-btn-text-color` | Color of search button label text | `Based on uvalib-theme --color-secondary-blue`
`--uvalib-search-box-advanced-text-color` | Color of advanced search options | `Based on uvalib-theme --color-white`

@demo demo/index.html
-->

<dom-module id="uvalib-search-box">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        font-family: var(--uvalib-search-box-font-family,--font-primary);
        --paper-input-container-focus-color: var(--color-accessibility-outline);
      }
      iron-icon {
        width: 12px;
        height: 12px;
      }
      paper-tabs {
        width: 40%;
        background-color: var(--uvalib-search-box-tab-color,--color-secondary-blue);
        color: var(--uvalib-search-box-tab-text-color,--color-light-blue);
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
      }
      paper-tab.iron-selected {
        background-color: var(--uvalib-search-box-selected-tab-color,--color-primary-blue);
        color: var(--uvalib-search-box-selected-tab-text-color,--color-white);
      }
      #single-search,
      iron-pages {
        background-color: var(--uvalib-search-box-bkgrd-color,--color-primary-blue);
        margin-left: auto;
        margin-right: auto;
        padding-top: 15px;
        padding-bottom: 30px;
        border-top-right-radius: 3px;
        border-bottom-left-radius: 3px;
        border-bottom-right-radius: 3px;
      }
      uvalib-button {
        background-color: var(--uvalib-search-box-btn-bkgrd-color,--color-text-blue);
        color: var(--uvalib-search-box-btn-text-color,--color-white);
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        border-top-right-radius: 3px;
        border-bottom-right-radius: 3px;
        display: inline-block;
      }
      uvalib-button span {
        font-weight: bold;
      }
      .advancedSearch {
        margin-left: auto;
        margin-right: auto;
        width: 94%;
        padding-bottom: 10px;
        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
      }
      .catalog-search {
        float: left;
        padding-right: 20px;
      }
      .searchLink a {
        color: var(--uvalib-search-box-advanced-text-color,--color-white);
        text-decoration: none;
      }
      #site {
        padding-top: 10px;
      }
      .search-field {
        margin: 0px;
        padding: 0px;
        display: inline-block;
        width: 91%;
        --paper-input-container: {
          background-color: white;
          color: var(--color-text-gray);
          border-top-right-radius: 0;
          border-bottom-right-radius: 0;
          border-top-left-radius: 3px;
          border-bottom-left-radius: 3px;
          line-height: 30px;
        }

        --paper-input-container-underline: {
          display: none;
        }
        --paper-input-container-underline-focus: {
          display: none;
        }
        --paper-input-container-underline-disabled: {
          display: none;
        }

        --paper-input-container-input: {
          padding-left: 10px;
          padding-right: 10px;
        }
      }
      .searchbox {
        margin-left: auto;
        margin-right: auto;
        width: 94%;
        @apply(--layout-horizontal);
        @apply(--layout-end-justified);
      }
      #single-search {
        padding-top: 20px;
        padding-bottom: 20px;
      }
    </style>

    <div class="" role="search">
      <template is="dom-if" if="{{siteSearch}}">
        <paper-tabs selected="{{selectedTab}}" no-bar no-slide autoselect>
          <paper-tab tabindex="0">{{virgoSearchTabText}}</paper-tab>
            <paper-tab tabindex="0">{{siteSearchTabText}}</paper-tab>
        </paper-tabs>
        <iron-pages id="pages" selected="{{selectedTab}}">
          <div id="virgo">
            <div class="advancedSearch">
              <template is="dom-if" if="{{advancedSearch}}">
                <div class="searchLink catalog-search">
                  <a href="{{advancedCatalogSearchUrl}}" tabindex="0">{{advancedCatalogSearchText}} <iron-icon icon="chevron-right"></iron-icon></a>
                </div>
                <div class="searchLink">
                  <a href="{{advancedArticleSearchUrl}}" tabindex="0">{{advancedArticleSearchText}} <iron-icon icon="chevron-right"></iron-icon></a>
                </div>
              </template>
            </div>
            <form is="iron-form" method="get" action="{{virgoSearchTabUrl}}" id="virgoSearchForm">
              <input type="hidden" name="portal" value="all">
              <input type="hidden" name="catalog_select" value="all">
              <input type="hidden" name="sort" value="date_received_facet desc">
              <div class="searchbox">
                <paper-input no-label-float class="search-field" id="q1" name="q" label="" placeholder="{{searchVirgoPlaceholder}}" tabindex="0">
                </paper-input>
                <uvalib-button class="search" onclick="submitCatalogSearch()" alt="Search Virgo"><span>Search</span></uvalib-button>
              </div>
            </form>
          </div>
          <div id="site">
            <form is="iron-form" method="get" action="{{siteSearchTabUrl}}" id="siteSearchForm">
              <div class="searchbox">
                <paper-input no-label-float class="search-field" id="q2" name="q" label="" placeholder="{{searchSitePlaceholder}}" tabindex="0">
                </paper-input>
                <uvalib-button onclick="submitSiteSearch()" alt="Search Website"><span>Search</span></uvalib-button>
              </div>
            </form>
          </div>
        </iron-pages>
      </template>
      <template is="dom-if" if="{{!siteSearch}}">
        <div id="single-search">
          <form is="iron-form" method="get" action="{{virgoSearchTabUrl}}" id="singleSearchForm">
            <input type="hidden" name="portal" value="all">
            <input type="hidden" name="catalog_select" value="all">
            <input type="hidden" name="sort" value="date_received_facet desc">
            <div class="searchbox">
              <paper-input no-label-float class="search-field" id="q3" name="q" label="" placeholder="{{searchVirgoPlaceholder}}" tabindex="0">
              </paper-input>
              <template is="dom-if" if="{{!useIconForButton}}">
                <uvalib-button onclick="submitCatalogSearch()" alt="Search Virgo"><span>Search</span></uvalib-button>
              </template>
              <template is="dom-if" if="{{useIconForButton}}">
                <uvalib-button alt="Search Virgo" onclick="submitCatalogSearch()" icon="search"></uvalib-button>
              </template>
            </div>
          </form>
        </div>
      </template>

    </div>
  </template>

  <script>
    Polymer({

      is: 'uvalib-search-box',
      behaviors: [uvalibbehaviors.searchbox],
      properties: {
        _searchVirgoBtn: {
          type: Object,
          value: function() {
            return this.querySelector('searchvirgobtn');
          }
        },
        _searchSiteBtn: {
          type: Object,
          value: function() {
            return this.querySelector('searchsitebtn');
          }
        },
        _searchVirgoBtn2: {
          type: Object,
          value: function() {
            return this.querySelector('searchvirgobtn2');
          }
        },
        _searchVirgoIcon: {
          type: Object,
          value: function() {
            return this.querySelector('searchvirgoicon');
          }
        },

      },

      focusTextbox: function() {
        this.querySelector('iron-pages > div.iron-selected paper-input').focus();
      },

      _jumpToSearchInputText: function(e) {
        e.preventDefault();
        console.log('jumpToSearchInputText');
        console.log(e.detail);
        var x = this.querySelector('iron-pages > div.iron-selected paper-input');
        console.log(x);
        this.querySelector('iron-pages > div.iron-selected paper-input').focus();
      },

      _jumpToVirgoSearchInput: function(e) {
        console.log('jumpToVirgoSearchInput');
        console.log(e.detail);
        e.preventDefault();
        this.querySelector('#single-search > paper-input').focus();
      }

    });

  </script>
</dom-module>

<dom-module id="uvalib-search-area">
  <template>
    <style is="custom-style" include="uvalib-theme">
      :host {
        display: block;
        @apply(--layout-vertical);
        @apply(--layout-center);
      }
      #container {
        width: 100%;
        max-width: var(--uvalib-display-width-max);
        @apply(--layout-horizontal);
      }
      #main {
        @apply(--layout-flex);
      }
      #close {
        width: 100px;
        @apply(--layout-horizontal);
        @apply(--layout-end);
      }
      #close paper-icon-button {
        color: #002f6c;
        height: 60px;
        width: 60px;
      }
      #links {
        @apply(--layout-horizontal);
        height: 44px;
      }
      #search {
        @apply(--layout-horizontal);
        height: 56px;
      }
      #links, #search {

      }
      .spacer {
        @apply(--layout-flex);
      }
      #links uvalib-button {
        --uvalib-button-text-transform: none;
        --uvalib-button: {
          font-family: SofiaPro;
          font-size: 16px;
          font-weight: normal;
          font-style: normal;
          font-stretch: normal;
          line-height: normal;
          letter-spacing: 1.1px;
          color: #000000;
        };
      }
      #search form {
        @apply(--layout-flex);
        @apply(--layout-horizontal);
      }
      #search input {
        @apply(--layout-flex);
        display: inline-block;
        box-sizing: content-box;
        padding: 0 31px 0 31px;
        height: 54px;
        border-top-left-radius: 2px;
        border-bottom-left-radius: 2px;
        background-color: #fafafa;
        border: solid 1px #e0e0e0;
        font-family: SofiaPro;
        font-size: 19px;
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: 1px;
        text-align: left;
        color: #000000;

      }
      #search input::placeholder {
        font-family: SofiaPro;
        font-size: 19px;
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        line-height: normal;
        letter-spacing: 1px;
        text-align: left;
        color: rgba(0, 0, 0, 0.23);
      }
      #search paper-menu-button {
        width: 218px;
        height: 54px;
        padding: 0;
        background-color: #eeeeee;
        border: solid 1px #e0e0e0;
        border-left-width: 0;
      }
      #search paper-menu-button paper-button {
        width: 218px;
        --paper-button: {
          text-transform: none;
        };
        font-size: 19px;
      }
      #search paper-button {
        font-family: SofiaPro;
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        line-height: 1.21;
        letter-spacing: 1px;
        color: rgba(0, 0, 0, 0.54);
      }
      #search paper-button.submit {
        width: 189px;
        font-size: 22px;
        font-weight: 500;
        line-height: normal;
        letter-spacing: 0.6px;
        color: #ffffff;
        border-top-right-radius: 2px;
        border-bottom-right-radius: 2px;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
        background-color: #0065e6;
        margin: 0;
      }
    </style>
    <div id="container">
      <div id="main">
        <div id="links">
          <div class="spacer"></div>
          <uvalib-button href="{{advancedCatalogSearchUrl}}" icon="angle-right" reverse>{{advancedCatalogSearchText}}</uvalib-button>
          <uvalib-button href="{{advancedArticleSearchUrl}}" icon="angle-right" reverse>{{advancedArticleSearchText}}</uvalib-button>
        </div>
        <div id="search">
          <template is="dom-if" if="{{_isVirgo(selectedIndex)}}">
            <form is="iron-form" method="get" action="{{virgoSearchTabUrl}}" id="virgoSearchForm">
              <input type="hidden" name="portal" value="all">
              <input type="hidden" name="catalog_select" value="all">
              <input type="hidden" name="sort" value="date_received_facet desc">
              <input id="q1" name="q" placeholder="{{searchVirgoPlaceholder}}">
            </form>
          </template>
          <template is="dom-if" if="{{!_isVirgo(selectedIndex)}}">
            <form is="iron-form" method="get" action="{{siteSearchTabUrl}}" id="siteSearchForm">
              <input id="q2" name="q" placeholder="{{searchSitePlaceholder}}">
            </form>
          </template>
          <paper-menu-button>
            <paper-button class="dropdown-trigger" noink elevation="0">
              <span>{{selectedIndex}}</span>
              <iron-icon icon="angle-down"></iron-icon>
            </paper-button>
            <paper-menu class="dropdown-content" selected="{{selectedIndex}}" attr-for-selected="val">
              <paper-item val="Site Search">Site Search</paper-item>
              <paper-item val="Virgo">Virgo</paper-item>
            </paper-menu>
          </paper-menu-button>
          <paper-button class="submit" on-tap="_submit">Search</paper-button>
        </div>
      </div>
      <div id="close">
        <paper-icon-button icon="times" on-tap="_close"></paper-icon-button>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'uvalib-search-area',
      behaviors: [uvalibbehaviors.searchbox],
      properties: {

        selectedIndex: {
          type: String,
          value: "Virgo"
        }

      },
      _isVirgo: function(){
        return (this.selectedIndex === "Virgo");
      },
      _submit: function(){
        if (this._isVirgo()) this.submitCatalogSearch();
        else this.submitSiteSearch();
      },
      _close: function(){
        this.fire('close');
      }

    });

  </script>
</dom-module>
